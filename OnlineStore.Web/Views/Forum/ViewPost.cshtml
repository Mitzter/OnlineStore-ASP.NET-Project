
@using OnlineStore.Web.Models.UserModels;
@using System.Text;
@model PostViewModel

@{
    ViewBag.Title = Model.Title;
}
@functions{
    private string GetProfileImage(ApplicationUser user)
    {
        if (user.PictureSource == null)
    {
            return "/images/default-user-picture.png";
        }
        else
        {
            string base64Image = Convert.ToBase64String(user.PictureSource);
            string imageSrc = $"data:image/png;base64,{base64Image}";
            return imageSrc;
        }
    }
}

<style>
    .section-post-outline{
        border: 2px solid brown;
        padding: 20px;
        
    }
    .section-outline {
        border: 5px solid brown;
        padding: 10px;
        background-color:darkgray
    }
    .section-comment-outline{
        border: 1px solid gray;
        padding: 10px;
    }
     .w1-sidebar {
        border: 1px solid brown;
        margin-right: auto;
        margin-left: 0;
    }
</style>
<h2 class="text-center text-light">@ViewBag.Title</h2>
<hr />

<div class="container-fluid col-md-6 section-outline align-content-center">
    <div class="row">
        <div class="col-2">
            <img src="@GetProfileImage(Model.Poster)" alt="User Image" class="img-fluid rounded-circle">
            <h6>@Model.Poster.DisplayName</h6>
            <p>Posted at: @Model.CreatedAt</p>
        </div>
        <div class="col-10">
            <p class="section-post-outline text-dark">@Model.Text</p>
        </div>
    </div>
    <hr />

    @foreach (var reply in Model.Replies)
    {
        if (reply != null)
        {
            <div class="row">
                <div class="col-2">
                    <img src="@GetProfileImage(reply.User)" alt="User Image" class="img-fluid rounded-circle">
                    <h6>@reply.User.DisplayName</h6>
                    <p>Posted at: @reply.CreatedOn</p>
                </div>
                <div class="col-10">
                    <p class="section-comment-outline text-dark">
                        @reply.Message
                    </p>
                </div>
            </div>
            <hr />
        }
    }

    @if (User.Identity.IsAuthenticated)
    {
        <h5 class="align-content-center text-light">Reply!</h5>
        @Html.Partial("_CreateReplyPartial", new ReplyFormModel { PostedAtId = Model.Id })
    }
</div>

